import{r as m,s as le,D as K,y as V,v as Pe,w as R,R as ce,x as Re,z as he,A as Q,X as G,I as X,B as ve,F as je,G as Se,H as J,J as Ne,T as Ce,K as I,P as De,Q as q,U as ke,V as ue,W as ge,Y as Me,u as ye,Z as F,a as E,$ as Ae,o as C,e as T,a0 as P,a1 as _,a2 as Fe,j as t,d as N,a3 as U,a4 as B,c as A,S as be,a5 as Te,a6 as Ie,a7 as de,a8 as W,a9 as $e,aa as Le,E as ze}from"./index-22564d29.js";import{C as Oe,I as me}from"./Input-e8c88e5c.js";import{E as M}from"./context-590d39df.js";import{F as _e,P as fe}from"./PlanChangePreview-28eae11b.js";import{c as Be,d as Qe,e as D,x as Ue}from"./context-cc73b64e.js";import{s as Ke,k as pe}from"./popover-af5c7c25.js";import{M as Ve}from"./disclosure-47be1803.js";import"./ModelLineage-96ab515c.js";import"./PlusIcon-04528d91.js";import"./_commonjs-dynamic-modules-302442b1.js";function Ge({title:e,titleId:a,...r},n){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:n,"aria-labelledby":a},r),e?m.createElement("title",{id:a},e):null,m.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z",clipRule:"evenodd"}))}const He=m.forwardRef(Ge),Je=He;function We({title:e,titleId:a,...r},n){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:n,"aria-labelledby":a},r),e?m.createElement("title",{id:a},e):null,m.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"}))}const Ye=m.forwardRef(We),qe=Ye;var Xe=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Xe||{}),Ze=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Ze||{}),et=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(et||{});function Y(e,a=r=>r){let r=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,n=Me(a(e.items.slice()),f=>f.dataRef.current.domRef.current),l=r?n.indexOf(r):null;return l===-1&&(l=null),{items:n,activeItemIndex:l}}let tt={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},2:(e,a)=>{var r;let n=Y(e),l=Ue(a,{resolveItems:()=>n.items,resolveActiveIndex:()=>n.activeItemIndex,resolveId:f=>f.id,resolveDisabled:f=>f.dataRef.current.disabled});return{...e,...n,searchQuery:"",activeItemIndex:l,activationTrigger:(r=a.trigger)!=null?r:1}},3:(e,a)=>{let r=e.searchQuery!==""?0:1,n=e.searchQuery+a.value.toLowerCase(),l=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+r).concat(e.items.slice(0,e.activeItemIndex+r)):e.items).find(c=>{var s;return((s=c.dataRef.current.textValue)==null?void 0:s.startsWith(n))&&!c.dataRef.current.disabled}),f=l?e.items.indexOf(l):-1;return f===-1||f===e.activeItemIndex?{...e,searchQuery:n}:{...e,searchQuery:n,activeItemIndex:f,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,a)=>{let r=Y(e,n=>[...n,{id:a.id,dataRef:a.dataRef}]);return{...e,...r}},6:(e,a)=>{let r=Y(e,n=>{let l=n.findIndex(f=>f.id===a.id);return l!==-1&&n.splice(l,1),n});return{...e,...r,activationTrigger:1}}},Z=m.createContext(null);Z.displayName="MenuContext";function H(e){let a=m.useContext(Z);if(a===null){let r=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,H),r}return a}function nt(e,a){return he(a.type,tt,e,a)}let at=m.Fragment;function st(e,a){let{__demoMode:r=!1,...n}=e,l=m.useReducer(nt,{__demoMode:r,menuState:r?0:1,buttonRef:m.createRef(),itemsRef:m.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:f,itemsRef:c,buttonRef:s},i]=l,h=V(a);Pe([s,c],(w,j)=>{var u;i({type:1}),Ne(j,Ce.Loose)||(w.preventDefault(),(u=s.current)==null||u.focus())},f===0);let y=R(()=>{i({type:1})}),x=m.useMemo(()=>({open:f===0,close:y}),[f,y]),v={ref:h};return ce.createElement(Z.Provider,{value:l},ce.createElement(Re,{value:he(f,{0:Q.Open,1:Q.Closed})},G({ourProps:v,theirProps:n,slot:x,defaultTag:at,name:"Menu"})))}let rt="button";function it(e,a){var r;let n=X(),{id:l=`headlessui-menu-button-${n}`,...f}=e,[c,s]=H("Menu.Button"),i=V(c.buttonRef,a),h=ve(),y=R(u=>{switch(u.key){case I.Space:case I.Enter:case I.ArrowDown:u.preventDefault(),u.stopPropagation(),s({type:0}),h.nextFrame(()=>s({type:2,focus:D.First}));break;case I.ArrowUp:u.preventDefault(),u.stopPropagation(),s({type:0}),h.nextFrame(()=>s({type:2,focus:D.Last}));break}}),x=R(u=>{switch(u.key){case I.Space:u.preventDefault();break}}),v=R(u=>{if(De(u.currentTarget))return u.preventDefault();e.disabled||(c.menuState===0?(s({type:1}),h.nextFrame(()=>{var d;return(d=c.buttonRef.current)==null?void 0:d.focus({preventScroll:!0})})):(u.preventDefault(),s({type:0})))}),w=m.useMemo(()=>({open:c.menuState===0}),[c]),j={ref:i,id:l,type:Ke(e,c.buttonRef),"aria-haspopup":"menu","aria-controls":(r=c.itemsRef.current)==null?void 0:r.id,"aria-expanded":c.menuState===0,onKeyDown:y,onKeyUp:x,onClick:v};return G({ourProps:j,theirProps:f,slot:w,defaultTag:rt,name:"Menu.Button"})}let ot="div",lt=le.RenderStrategy|le.Static;function ct(e,a){var r,n;let l=X(),{id:f=`headlessui-menu-items-${l}`,...c}=e,[s,i]=H("Menu.Items"),h=V(s.itemsRef,a),y=je(s.itemsRef),x=ve(),v=Se(),w=(()=>v!==null?(v&Q.Open)===Q.Open:s.menuState===0)();m.useEffect(()=>{let o=s.itemsRef.current;o&&s.menuState===0&&o!==(y==null?void 0:y.activeElement)&&o.focus({preventScroll:!0})},[s.menuState,s.itemsRef,y]),_e({container:s.itemsRef.current,enabled:s.menuState===0,accept(o){return o.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:o.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(o){o.setAttribute("role","none")}});let j=R(o=>{var b,k;switch(x.dispose(),o.key){case I.Space:if(s.searchQuery!=="")return o.preventDefault(),o.stopPropagation(),i({type:3,value:o.key});case I.Enter:if(o.preventDefault(),o.stopPropagation(),i({type:1}),s.activeItemIndex!==null){let{dataRef:g}=s.items[s.activeItemIndex];(k=(b=g.current)==null?void 0:b.domRef.current)==null||k.click()}ge(s.buttonRef.current);break;case I.ArrowDown:return o.preventDefault(),o.stopPropagation(),i({type:2,focus:D.Next});case I.ArrowUp:return o.preventDefault(),o.stopPropagation(),i({type:2,focus:D.Previous});case I.Home:case I.PageUp:return o.preventDefault(),o.stopPropagation(),i({type:2,focus:D.First});case I.End:case I.PageDown:return o.preventDefault(),o.stopPropagation(),i({type:2,focus:D.Last});case I.Escape:o.preventDefault(),o.stopPropagation(),i({type:1}),q().nextFrame(()=>{var g;return(g=s.buttonRef.current)==null?void 0:g.focus({preventScroll:!0})});break;case I.Tab:o.preventDefault(),o.stopPropagation(),i({type:1}),q().nextFrame(()=>{ke(s.buttonRef.current,o.shiftKey?ue.Previous:ue.Next)});break;default:o.key.length===1&&(i({type:3,value:o.key}),x.setTimeout(()=>i({type:4}),350));break}}),u=R(o=>{switch(o.key){case I.Space:o.preventDefault();break}}),d=m.useMemo(()=>({open:s.menuState===0}),[s]),S={"aria-activedescendant":s.activeItemIndex===null||(r=s.items[s.activeItemIndex])==null?void 0:r.id,"aria-labelledby":(n=s.buttonRef.current)==null?void 0:n.id,id:f,onKeyDown:j,onKeyUp:u,role:"menu",tabIndex:0,ref:h};return G({ourProps:S,theirProps:c,slot:d,defaultTag:ot,features:lt,visible:w,name:"Menu.Items"})}let ut=m.Fragment;function dt(e,a){let r=X(),{id:n=`headlessui-menu-item-${r}`,disabled:l=!1,...f}=e,[c,s]=H("Menu.Item"),i=c.activeItemIndex!==null?c.items[c.activeItemIndex].id===n:!1,h=m.useRef(null),y=V(a,h);J(()=>{if(c.__demoMode||c.menuState!==0||!i||c.activationTrigger===0)return;let g=q();return g.requestAnimationFrame(()=>{var $,L;(L=($=h.current)==null?void 0:$.scrollIntoView)==null||L.call($,{block:"nearest"})}),g.dispose},[c.__demoMode,h,i,c.menuState,c.activationTrigger,c.activeItemIndex]);let x=Be(h),v=m.useRef({disabled:l,domRef:h,get textValue(){return x()}});J(()=>{v.current.disabled=l},[v,l]),J(()=>(s({type:5,id:n,dataRef:v}),()=>s({type:6,id:n})),[v,n]);let w=R(()=>{s({type:1})}),j=R(g=>{if(l)return g.preventDefault();s({type:1}),ge(c.buttonRef.current)}),u=R(()=>{if(l)return s({type:2,focus:D.Nothing});s({type:2,focus:D.Specific,id:n})}),d=Qe(),S=R(g=>d.update(g)),o=R(g=>{d.wasMoved(g)&&(l||i||s({type:2,focus:D.Specific,id:n,trigger:0}))}),b=R(g=>{d.wasMoved(g)&&(l||i&&s({type:2,focus:D.Nothing}))}),k=m.useMemo(()=>({active:i,disabled:l,close:w}),[i,l,w]);return G({ourProps:{id:n,ref:y,role:"menuitem",tabIndex:l===!0?void 0:-1,"aria-disabled":l===!0?!0:void 0,disabled:void 0,onClick:j,onFocus:u,onPointerEnter:S,onMouseEnter:S,onPointerMove:o,onMouseMove:o,onPointerLeave:b,onMouseLeave:b},theirProps:f,slot:k,defaultTag:ut,name:"Menu.Item"})}let mt=K(st),ft=K(it),pt=K(ct),xt=K(dt),z=Object.assign(mt,{Button:ft,Items:pt,Item:xt});function Nt(){const{setIsPlanOpen:e}=ye(),a=F(p=>p.state),r=F(p=>p.action),n=F(p=>p.setState),l=F(p=>p.setAction),f=F(p=>p.setActivePlan),c=E(p=>p.addConfirmation),s=E(p=>p.setShowConfirmation),i=E(p=>p.environment),h=E(p=>p.environments),y=E(p=>p.setInitialDates),x=E(p=>p.hasSynchronizedEnvironments),[v,w]=m.useState(!1),[j,u]=m.useState(),[d,S]=m.useState(!1),{refetch:o,data:b,isFetching:k}=Ae(i.name,{planOptions:{skip_tests:!0,include_unmodified:!0}});m.useEffect(()=>{d&&(g(),S(!1)),!C(i.isSynchronized)&&o()},[i]),m.useEffect(()=>{var p,te,ne,ae,se,re,ie,oe;b!=null&&(u(b),y(b.start,b.end),w([(p=b.changes)==null?void 0:p.added,(te=b.changes)==null?void 0:te.removed,(ae=(ne=b.changes)==null?void 0:ne.modified)==null?void 0:ae.direct,(re=(se=b.changes)==null?void 0:se.modified)==null?void 0:re.indirect,(oe=(ie=b.changes)==null?void 0:ie.modified)==null?void 0:oe.metadata].some(T)))},[b]);function g(){f(void 0),n(P.Init),l(_.Run),e(!0)}const L=(C(i.isDefault)||x())&&(C(i.isDefault)||C(i.isInitial)),we=Fe([P.Applying,P.Running,P.Cancelling],a),ee=k||r!==_.None||a===P.Applying||a===P.Running||a===P.Cancelling;return t.jsxs("div",{className:N("flex items-center",i==null&&"opacity-50 pointer-events-none cursor-not-allowed"),children:[t.jsxs("div",{className:"flex items-center relative",children:[t.jsxs(U,{className:N("mx-0",C(i.isInitial&&i.isDefault)&&"rounded-none rounded-l-lg border-r"),disabled:ee,variant:B.Alternative,size:A.sm,onClick:p=>{p.stopPropagation(),i.isDefault&&C(i.isInitial)?c({headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${i.name}`,noText:"No, Cancel",action(){g()},children:t.jsxs("div",{className:"mt-5 pt-4",children:[t.jsx("h4",{className:"mb-2",children:`${h.size>1?"Select or ":""}Add Environment`}),t.jsxs("div",{className:"flex items-center relative",children:[h.size>1&&t.jsx(xe,{className:"mr-2",side:"left",environment:i,showAddEnvironment:!1,onSelect:()=>{S(!0),s(!1)},size:A.md,disabled:k||r!==_.None||a===P.Applying||a===P.Cancelling}),t.jsx(Ee,{className:"w-full",size:A.md,onAdd:()=>{S(!0),s(!1)}})]})]})}):g()},children:[we&&t.jsx(be,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block",children:vt(a,r)})]}),L&&t.jsx(xe,{className:"rounded-none rounded-r-lg border-l mx-0",environment:i,disabled:ee})]}),t.jsx(ht,{environment:i,plan:j,isLoading:k,hasChanges:v})]})}function ht({isLoading:e,hasChanges:a,environment:r,plan:n}){var l,f,c,s;return t.jsx("span",{className:"flex align-center h-full w-full",children:t.jsx(t.Fragment,{children:e?t.jsxs("span",{className:"flex items-center ml-2",children:[t.jsx(be,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block text-xs text-neutral-500",children:"Checking..."})]}):t.jsxs(t.Fragment,{children:[r.isInitial&&r.isLocal&&t.jsx("span",{title:"New",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),[a,e,r.isLocal].every(C)&&t.jsx("span",{title:"Latest",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:t.jsx("span",{children:"Latest"})}),T((l=n==null?void 0:n.changes)==null?void 0:l.added)&&t.jsx(O,{headline:"Added Models",type:M.Add,changes:n.changes.added}),T((f=n==null?void 0:n.changes)==null?void 0:f.modified.direct)&&t.jsx(O,{headline:"Direct Changes",type:M.Direct,changes:n.changes.modified.direct.map(({model_name:i})=>i)}),T((c=n==null?void 0:n.changes)==null?void 0:c.modified.indirect)&&t.jsx(O,{headline:"Indirectly Modified",type:M.Indirect,changes:n.changes.modified.indirect.map(i=>i.model_name)}),T((s=n==null?void 0:n.changes)==null?void 0:s.removed)&&t.jsx(O,{headline:"Removed Models",type:M.Remove,changes:n.changes.removed})]})})})}function xe({onSelect:e,environment:a,disabled:r,side:n=W.Right,className:l,showAddEnvironment:f=!0,size:c=A.sm}){const{addError:s}=ye(),i=E(u=>u.environments),h=E(u=>u.pinnedEnvironments),y=E(u=>u.defaultEnvironment),x=E(u=>u.setEnvironment),v=E(u=>u.removeLocalEnvironment),w=Te(z.Button);function j(u){Le(u.name).then(()=>{v(u)}).catch(d=>{s(ze.Environments,d)})}return t.jsx(z,{children:({close:u})=>t.jsxs(t.Fragment,{children:[t.jsxs(w,{variant:B.Alternative,size:c,disabled:r,className:N(l),children:[t.jsx("span",{className:N("block overflow-hidden truncate",(a.isLocal||r)&&"text-neutral-500",a.isSynchronized&&"text-primary-500"),children:a.name}),t.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:t.jsx(Oe,{className:"h-4 w-4","aria-hidden":"true"})})]}),t.jsx(Ie,{as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsxs("div",{className:N("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",n===W.Left&&"left-0",n===W.Right&&"right-0"),children:[t.jsxs(z.Items,{className:"overflow-auto max-h-80 py-2 hover:scrollbar scrollbar--vertical",children:[Array.from(i).map(d=>t.jsx(z.Item,{children:({active:S})=>t.jsxs("div",{onClick:o=>{o.stopPropagation(),x(d),e==null||e()},className:N("flex justify-between items-center pl-2 pr-1 py-1 cursor-pointer overflow-auto",S&&"bg-primary-10",d===a&&"pointer-events-none cursor-default bg-secondary-10"),children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(Je,{className:N("w-4 h-4 text-primary-500 mt-1.5",S&&"opacity-10",d!==a&&"opacity-0")}),t.jsxs("span",{className:"block",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("span",{className:N("block truncate ml-2",d.isSynchronized&&"text-primary-500"),children:d.name}),t.jsxs("small",{className:"block ml-2",children:["(",d.type,")"]})]}),d.isDefault&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Main Environment"})}),y===d&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),t.jsxs("div",{className:"flex items-center",children:[d.isPinned&&t.jsx(qe,{title:"Pinned",className:"w-4 text-primary-500 dark:text-primary-100 mx-1"}),d.isLocal&&C(d.isPinned)&&d!==a&&t.jsx(U,{className:"!m-0 !px-2 bg-transparent hover:bg-transparent border-none",size:A.xs,variant:B.Neutral,onClick:o=>{o.stopPropagation(),v(d)},children:t.jsx(Ve,{className:"w-4 text-neutral-500 dark:text-neutral-100"})}),C(d.isDefault)&&d!==a&&d.isSynchronized&&C(h.includes(d))&&t.jsx(U,{className:"!px-2 !my-0",size:A.xs,variant:B.Danger,onClick:o=>{o.stopPropagation(),j(d)},children:"Delete"})]})]})},d.name)),f&&t.jsxs(t.Fragment,{children:[t.jsx(de,{}),t.jsx(Ee,{onAdd:u,className:"mt-2 px-2"})]})]}),t.jsx(de,{})]})})]})})}function Ee({onAdd:e,className:a,label:r="Add",size:n=A.sm}){const l=E(x=>x.getNextEnvironment),f=E(x=>x.isExistingEnvironment),c=E(x=>x.addLocalEnvironment),[s,i]=m.useState(""),[h,y]=m.useState(l().name);return t.jsxs("div",{className:N("flex w-full items-center",a),children:[t.jsx(me,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:n,children:({className:x})=>t.jsx(me.Textfield,{className:N(x,"w-full"),placeholder:"Environment",value:s,onInput:v=>{v.stopPropagation(),i(v.target.value)}})}),t.jsx(U,{className:"my-0 mx-0 font-bold",size:n,disabled:$e(s)||f(s),onClick:x=>{x.stopPropagation(),c(s,h),i(""),y(l().name),e==null||e()},children:r})]})}function O({headline:e,type:a,changes:r}){const[n,l]=m.useState(!1);return t.jsx(pe,{onMouseEnter:()=>{l(!0)},onMouseLeave:()=>{l(!1)},className:"relative flex",children:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:N("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",a===M.Add&&"bg-success-500 border-success-500",a===M.Remove&&"bg-danger-500 border-danger-500",a===M.Direct&&"bg-secondary-500 border-secondary-500",a===M.Indirect&&"bg-warning-500 border-warning-500",a==="metadata"&&"bg-neutral-500 border-neutral-500"),children:r.length}),t.jsx(Ie,{show:n,as:m.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:t.jsx(pe.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:t.jsx(fe,{headline:e,type:a,className:"w-full h-full max-w-[50vw] max-h-[40vh] overflow-hidden overflow-y-auto ",children:t.jsx(fe.Default,{type:a,changes:r})})})})]})})}function vt(e,a){return e===P.Running?"Running Plan...":e===P.Applying?"Applying Plan...":e===P.Cancelling?"Cancelling Plan...":a===_.None?"Run Plan":"Setting Plan..."}export{Nt as default};
