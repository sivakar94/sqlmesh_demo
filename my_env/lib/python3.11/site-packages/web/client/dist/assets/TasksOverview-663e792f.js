import{j as e,d as i,r as D,av as b,a7 as $,a0 as S,t as z}from"./index-22564d29.js";import{p as O}from"./pluralize-d3f68cf8.js";import{E as c}from"./context-590d39df.js";function M({progress:s=0,delay:t=0,duration:n=0,className:a}){return e.jsx("div",{className:i("w-full h-1 bg-neutral-30 overflow-hidden flex items-center rounded-lg my-1",a),children:e.jsx("div",{className:"transition-[width] h-full bg-success-500 rounded-lg",style:{width:`${s}%`,transitionDelay:`${t}ms`,transitionDuration:`${n}ms`}})})}const u=function({children:t,setRefTasksOverview:n,tasks:a}){const{models:o,taskCompleted:j,taskTotal:x,batchesTotal:p,batchesCompleted:m}=D.useMemo(()=>{const d=Object.entries(a),r=d.length;let l=0,w=0,T=0;return d.forEach(([B,{completed:N,total:y}])=>{l=N===y?l+1:l,w+=y,T+=N}),{models:d,taskCompleted:l,taskTotal:r,batchesTotal:w,batchesCompleted:T}},[a]);return e.jsx("div",{className:"text-prose",ref:n,children:t({models:o,completed:j,total:x,totalBatches:p,completedBatches:m})})};function P({className:s,headline:t,environment:n,planState:a,completed:o,total:j,updatedAt:x,updateType:p,completedBatches:m,totalBatches:d}){return e.jsx(v,{className:s,children:e.jsxs(k,{children:[e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(F,{headline:t,environment:n,planState:a})}),e.jsxs(E,{children:[e.jsx(f,{completed:o,total:j,unit:"task"}),e.jsx(h,{}),e.jsx(f,{completed:m,total:d,unit:"batches"}),e.jsx(h,{}),e.jsx(R,{completed:m,total:d})]})]}),e.jsx(M,{progress:b(m,d)}),x!=null&&e.jsx(L,{updatedAt:x,updateType:p})]})})}function A({models:s,className:t,changes:n,showBatches:a=!0,showProgress:o=!0,showVirtualUpdate:j=!1}){const{changesAdded:x,changesRemoved:p,changesModifiedDirect:m,changesModifiedIndirect:d}=D.useMemo(()=>{const r=n==null?void 0:n.modified;return{changesAdded:(n==null?void 0:n.added)??[],changesRemoved:(n==null?void 0:n.removed)??[],changesModifiedMetadata:(r==null?void 0:r.metadata)??[],changesModifiedIndirect:((r==null?void 0:r.indirect)??[]).map(({model_name:l})=>l),changesModifiedDirect:((r==null?void 0:r.direct)??[]).map(({model_name:l})=>l)}},[n]);return e.jsx(v,{className:t,children:e.jsx(g,{models:s,children:([r,l])=>e.jsxs(k,{children:[e.jsxs(C,{children:[e.jsxs(I,{children:[l.interval!=null&&e.jsx(U,{start:l.interval[0],end:l.interval[1]}),e.jsx(_,{modelName:r,changeType:q({modelName:r,changesAdded:x,changesRemoved:p,changesModifiedDirect:m,changesModifiedIndirect:d})})]}),e.jsxs(E,{children:[a&&e.jsx(f,{completed:l.completed,total:l.total,unit:"batch"}),e.jsx(h,{}),o&&e.jsx(e.Fragment,{children:l.end==null||l.start==null?e.jsx(R,{total:l.total,completed:l.completed}):e.jsx(H,{start:l.start,end:l.end})}),j&&e.jsx("span",{className:"inline-block whitespace-nowrap font-bold ml-2",children:"Updated"})]})]}),o?e.jsx(M,{progress:b(l.completed,l.total)}):e.jsx($,{className:"my-1 border-neutral-200 opacity-50"})]})})})}function v({className:s,children:t}){return e.jsx("div",{className:i("my-3 mx-4 max-h-[50vh] overflow-auto hover:scrollbar scrollbar--vertical scrollbar--horizontal",s),children:t})}function k({className:s,children:t}){return e.jsx("div",{className:i("px-4",s),children:t})}function g({className:s,models:t,children:n}){return e.jsx("ul",{className:i("bg-neutral-10 rounded-lg py-4 overflow-auto text-prose hover:scrollbar scrollbar--vertical scrollbar--horizontal",s),children:t.map(([a,o])=>e.jsx("li",{className:"mb-2",children:n([a,o])},a))})}function C({className:s,children:t}){return e.jsx("div",{className:i("flex sm:justify-between sm:items-baseline text-xs",s),children:t})}function F({className:s,headline:t,environment:n,planState:a}){return e.jsxs("span",{className:i("flex items-center",s),children:[e.jsx("span",{className:"block whitespace-nowrap text-sm font-medium",children:t}),e.jsx("small",{className:"inline-block ml-1 px-2 py-[0.125rem] text-xs font-bold bg-neutral-10 rounded-md",children:n}),a!==S.Init&&e.jsxs(e.Fragment,{children:[e.jsx(h,{}),e.jsx("small",{className:"ml-1",children:a})]})]})}function I({className:s,children:t}){return e.jsx("div",{className:i("flex mr-6 w-full sm:w-auto overflow-hidden",s),children:t})}function E({className:s,children:t}){return e.jsx("div",{className:i("flex items-center",s),children:t})}function U({className:s,start:t,end:n}){return e.jsxs("span",{className:i("inline-block mr-2 whitespace-nowrap font-mono",s),children:[t," – ",n]})}function f({className:s,total:t,completed:n,unit:a}){return e.jsxs("span",{className:i("inline-block whitespace-nowrap",s),children:[n," of ",t," ",O(a,t)]})}function h({className:s}){return e.jsx("span",{className:i("inline-block mx-2",s),children:"|"})}function R({className:s,total:t,completed:n}){return e.jsxs("span",{className:i("inline-block whitespace-nowrap font-bold",s),children:[Math.ceil(b(n,t)),"%"]})}function H({className:s,start:t,end:n}){return e.jsx("span",{className:i("inline-block whitespace-nowrap font-bold",s),children:`${Math.floor((n-t)/6e4)}:${String(Math.ceil((n-t)/1e3%60)).padStart(2,"0")}`})}function L({updateType:s,updatedAt:t}){return e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsxs("small",{className:"text-xs",children:[e.jsx("b",{children:"Update Type:"}),e.jsx("span",{className:"inline-block ml-1",children:s})]}),e.jsxs("small",{className:"text-xs",children:[e.jsx("b",{children:"Last Update:"}),e.jsx("span",{className:"inline-block ml-1",children:z(new Date(t),"yyyy-mm-dd hh-mm-ss",!1)})]})]})}function _({className:s,modelName:t,changeType:n}){return e.jsx("span",{className:i("font-bold whitespace-nowrap",n===c.Add&&"text-success-600  dark:text-success-500",n===c.Remove&&"text-danger-500",n===c.Direct&&"text-secondary-500 dark:text-primary-500",n===c.Indirect&&"text-warning-500",n===c.Metadata&&"text-prose",s),children:t})}u.Block=v;u.Summary=P;u.Details=A;u.Task=k;u.Tasks=g;const Q=u;function q({modelName:s,changesAdded:t,changesRemoved:n,changesModifiedDirect:a,changesModifiedIndirect:o}){return t.includes(s)?c.Add:n.includes(s)?c.Remove:a.includes(s)?c.Direct:o.includes(s)?c.Indirect:c.Metadata}export{Q as T};
